<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Horario Maker</title>

<style>
body{
  font-family: Arial, sans-serif;
  margin:0;
  padding:15px;
  background:#f4f6f9;
}

h1{
  text-align:center;
  cursor:text;
  margin:0px 0 0px 0;
  font-size:28px;
}

.controls{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin-bottom:15px;
  justify-content:center;
}

.controls input,
.controls select,
.controls button{
  padding:5px;
  font-size:14px;
}

/* PANEL */

#designPanel{
  border:2px solid #333;
  padding:12px;
  margin-bottom:15px;
  background:#ffffff;
  display:none;
}

#deleteBtn{
  margin-top:10px;
  padding:8px 12px;
  background:#e53935;
  color:white;
  border:none;
  cursor:pointer;
  border-radius:5px;
}

/* HORARIO */

#scheduleWrapper{
  display:flex;
  flex-direction:column;
  border:1px solid #ccc;
  background:white;
}

#daysHeader{
  display:grid;
  grid-template-columns:60px repeat(7,1fr);
  border-bottom:1px solid #ccc;
}

.day-header{
  padding:8px;
  text-align:center;
  font-weight:bold;
  color:white;
}

.day-0{background:#ef5350;}
.day-1{background:#42a5f5;}
.day-2{background:#66bb6a;}
.day-3{background:#ab47bc;}
.day-4{background:#ffa726;}
.day-5{background:#26c6da;}
.day-6{background:#8d6e63;}

#scheduleContainer{
  display:flex;
  position:relative;
}

#timeMarkers{
  width:60px;
  position:relative;
  border-right:1px solid #ccc;
}

.time-marker{
  position:absolute;
  right:5px;
  transform:translateY(-50%);
  font-size:12px;
}

#schedule{
  flex:1;
  display:grid;
  grid-template-columns:repeat(7,1fr);
  position:relative;
}

.day-column{
  border-left:1px solid #ddd;
  position:relative;
}

.hour-line{
  position:absolute;
  left:0;
  right:0;
  height:1px;
  background:#e0e0e0;
}

.event{
  position:absolute;
  left:5px;
  right:5px;
  border-radius:8px;
  padding:6px;
  box-sizing:border-box;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  cursor:pointer;
}

.event-title{
  font-weight:bold;
}

.event-title,
.event-time{
  outline:none;
}

/* SOLO OCULTAR CONTROLES AL IMPRIMIR */
@media print {
  .controls { display: none; }
}
</style>
</head>
<body>

<!-- MODAL INICIAL -->
<div id="startupModal" style="
position:fixed;
inset:0;
background:rgba(0,0,0,0.5);
display:flex;
justify-content:center;
align-items:center;
z-index:9999;
">

  <div style="
  background:white;
  padding:30px;
  border-radius:12px;
  text-align:center;
  width:300px;
  box-shadow:0 10px 30px rgba(0,0,0,0.2);
  ">

    <h2>Configurar Horario</h2>

    <label>Hora inicio</label><br>
    <input type="time" id="modalStart" value="06:00"><br><br>

    <label>Hora fin</label><br>
    <input type="time" id="modalEnd" value="22:00"><br><br>

    <button onclick="startSchedule()" style="
      padding:8px 15px;
      border:none;
      background:#1976d2;
      color:white;
      border-radius:6px;
      cursor:pointer;
    ">
      Continuar
    </button>

  </div>
</div>

<h1 contenteditable="true">HORARIO</h1>

<div class="controls">
<select id="day">
  <option value="0">Domingo</option>
  <option value="1">Lunes</option>
  <option value="2">Martes</option>
  <option value="3">Mi√©rcoles</option>
  <option value="4">Jueves</option>
  <option value="5">Viernes</option>
  <option value="6">S√°bado</option>
</select>

<input type="text" id="title" placeholder="Curso / Actividad">
<input type="time" id="start">
<input type="time" id="end">

<button onclick="addEvent()">Agregar</button>
<button onclick="window.print()">Imprimir</button>
<button onclick="savePDF()">Guardar en PDF</button>
</div>

<div id="designPanel">
<h3>Panel de Dise√±o</h3>

<label>Fuente
<select id="editFont">
<option>Arial</option>
<option>Verdana</option>
<option>Tahoma</option>
<option>Times New Roman</option>
<option>Courier New</option>
</select>
</label>

<label>Tama√±o
<input type="number" id="editSize" value="14">
</label>

<label>Negrita
<input type="checkbox" id="editBold">
</label>

<label>Interlineado
<input type="number" id="editSpacing" value="4" min="0">
</label>

<br><br>

<label>Color fondo
<input type="color" id="editBgColor" value="#4caf50">
</label>

<label>Color borde
<input type="color" id="editBorderColor" value="#4caf50">
</label>

<br><br>

<label>Hora inicio
<input type="time" id="editStart">
</label>

<label>Hora fin
<input type="time" id="editEnd">
</label>

<br>

<button id="deleteBtn">üóë Eliminar actividad</button>
</div>

<div id="scheduleWrapper">
<div id="daysHeader">
  <div></div>
  <div class="day-header day-0">Domingo</div>
  <div class="day-header day-1">Lunes</div>
  <div class="day-header day-2">Martes</div>
  <div class="day-header day-3">Mi√©rcoles</div>
  <div class="day-header day-4">Jueves</div>
  <div class="day-header day-5">Viernes</div>
  <div class="day-header day-6">S√°bado</div>
</div>

<div id="scheduleContainer">
  <div id="timeMarkers"></div>
  <div id="schedule"></div>
</div>
</div>
<script>
let START_HOUR=6;
let END_HOUR=22;
const GRID_HEIGHT=900;

const schedule=document.getElementById("schedule");
const timeMarkers=document.getElementById("timeMarkers");
const designPanel=document.getElementById("designPanel");

let selectedEvent=null;

schedule.style.height=GRID_HEIGHT+"px";
timeMarkers.style.height=GRID_HEIGHT+"px";

/* MODAL */
function startSchedule(){
  const start=document.getElementById("modalStart").value;
  const end=document.getElementById("modalEnd").value;

  if(!start || !end) return alert("Completa las horas");

  START_HOUR=parseInt(start.split(":")[0]);
  END_HOUR=parseInt(end.split(":")[0]);

  schedule.innerHTML="";
  timeMarkers.innerHTML="";

  drawGrid();
  drawTimeMarkers();

  document.getElementById("startupModal").style.display="none";
}

function savePDF(){
  window.print();
}

/* GRID */
function drawGrid(){
  const totalHours=END_HOUR-START_HOUR;
  const hourHeight=GRID_HEIGHT/totalHours;

  for(let d=0;d<7;d++){
    const col=document.createElement("div");
    col.className="day-column";
    col.dataset.day=d;

    for(let h=0;h<=totalHours;h++){
      const line=document.createElement("div");
      line.className="hour-line";
      line.style.top=(h*hourHeight)+"px";
      col.appendChild(line);
    }

    schedule.appendChild(col);
  }
}

function drawTimeMarkers(){
  const totalHours=END_HOUR-START_HOUR;
  const hourHeight=GRID_HEIGHT/totalHours;

  for(let h=START_HOUR;h<=END_HOUR;h++){
    const marker=document.createElement("div");
    marker.className="time-marker";
    marker.style.top=((h-START_HOUR)*hourHeight)+"px";
    marker.textContent=(h<10?"0":"")+h+":00";
    timeMarkers.appendChild(marker);
  }
}

/* TIEMPO */
function timeToMinutes(t){
  const [h,m]=t.split(":").map(Number);
  return h*60+m;
}

function updateCoordinates(eventDiv,start,end){
  const totalMinutes=(END_HOUR-START_HOUR)*60;
  const minuteHeight=GRID_HEIGHT/totalMinutes;

  const startMin=timeToMinutes(start)-(START_HOUR*60);
  const endMin=timeToMinutes(end)-(START_HOUR*60);

  eventDiv.style.top=(startMin*minuteHeight)+"px";
  eventDiv.style.height=((endMin-startMin)*minuteHeight)+"px";
}

/* AGREGAR EVENTO */
function addEvent(){
  const day=document.getElementById("day").value;
  const title=document.getElementById("title").value;
  const start=document.getElementById("start").value;
  const end=document.getElementById("end").value;

  if(!title||!start||!end)return alert("Completa campos");

  const event=document.createElement("div");
  event.className="event";
  event.style.background="#4caf50";
  event.style.border="2px solid #4caf50";

  event.innerHTML=`
    <div class="event-title" contenteditable="true">${title}</div>
    <div class="event-time" contenteditable="true">${start} - ${end}</div>
  `;

  updateCoordinates(event,start,end);

  const timeDiv=event.querySelector(".event-time");

  timeDiv.addEventListener("input",function(){
    const regex=/^([0-2]?\d:[0-5]\d)\s*-\s*([0-2]?\d:[0-5]\d)$/;
    const match=this.innerText.trim().match(regex);
    if(match){
      updateCoordinates(event,match[1],match[2]);
    }
  });

  event.addEventListener("click",(e)=>{
    e.stopPropagation();
    selectedEvent=event;
    designPanel.style.display="block";

    const times=timeDiv.innerText.split("-");
    editStart.value=times[0].trim();
    editEnd.value=times[1].trim();
  });

  schedule.querySelector(`[data-day='${day}']`).appendChild(event);
}

/* PANEL */
editFont.oninput=()=>{if(selectedEvent)selectedEvent.style.fontFamily=editFont.value;}
editSize.oninput=()=>{if(selectedEvent)selectedEvent.style.fontSize=editSize.value+"px";}
editBold.oninput=()=>{if(selectedEvent)selectedEvent.style.fontWeight=editBold.checked?"bold":"normal";}
editSpacing.oninput=()=>{
  if(selectedEvent){
    selectedEvent.querySelector(".event-title").style.marginBottom=
      editSpacing.value+"px";
  }
};

editBgColor.oninput=()=>{if(selectedEvent)selectedEvent.style.background=editBgColor.value;}
editBorderColor.oninput=()=>{if(selectedEvent)selectedEvent.style.border="2px solid "+editBorderColor.value;}

editStart.oninput=()=>{if(selectedEvent)updateCoordinates(selectedEvent,editStart.value,editEnd.value);}
editEnd.oninput=()=>{if(selectedEvent)updateCoordinates(selectedEvent,editStart.value,editEnd.value);}

deleteBtn.onclick=()=>{
  if(selectedEvent){
    selectedEvent.remove();
    selectedEvent=null;
    designPanel.style.display="none";
  }
};

document.addEventListener("click",function(e){
  if(!e.target.closest(".event") && !e.target.closest("#designPanel")){
    designPanel.style.display="none";
    selectedEvent=null;
  }
});
</script>

</body>
</html>
